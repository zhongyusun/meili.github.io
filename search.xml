<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Laravel功能代码块</title>
      <link href="/2022/10/10/laravel-gong-neng-dai-ma-kuai/"/>
      <url>/2022/10/10/laravel-gong-neng-dai-ma-kuai/</url>
      
        <content type="html"><![CDATA[<h2 id="邮箱功能开发（qq邮箱为例）"><a href="#邮箱功能开发（qq邮箱为例）" class="headerlink" title="邮箱功能开发（qq邮箱为例）"></a>邮箱功能开发（qq邮箱为例）</h2><ul><li><p>MustVerifyEmail（强制认证，框架自带）</p><ol><li><p>调整User模型</p><p><em>app/Models/User.php</em></p><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">// 这里加上 MustVerifyEmail</span><span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Authenticatable</span> <span class="token keyword">implements</span> <span class="token class-name">MustVerifyEmail</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>调整路由</p><p><em>routes/web.php</em></p><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//demo</span><span class="token comment" spellcheck="true">//在注册跳转的页面添加验证邮箱中间件（verified）</span>Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token string">'PagesController@root'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">middleware</span><span class="token punctuation">(</span><span class="token string">'verified'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 在之前的路由里加上一个 verify 参数（用的自带的登录注册路由）</span>Auth<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'verify'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token boolean">true</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>配置env</p><pre class="line-numbers language-php"><code class="language-php"><span class="token constant">MAIL_DRIVER</span><span class="token operator">=</span>smtp<span class="token constant">MAIL_HOST</span><span class="token operator">=</span>smtp<span class="token punctuation">.</span>qq<span class="token punctuation">.</span>com<span class="token constant">MAIL_PORT</span><span class="token operator">=</span><span class="token number">25</span> <span class="token comment" spellcheck="true">//端口号</span><span class="token constant">MAIL_USERNAME</span><span class="token operator">=</span><span class="token number">2460245313</span>@qq<span class="token punctuation">.</span>com<span class="token constant">MAIL_PASSWORD</span><span class="token operator">=</span>qzjkngzxjmrneacc<span class="token constant">MAIL_ENCRYPTION</span><span class="token operator">=</span>tls<span class="token constant">MAIL_FROM_ADDRESS</span><span class="token operator">=</span><span class="token number">2460245313</span>@qq<span class="token punctuation">.</span>com <span class="token shell-comment comment">#发送方</span><span class="token constant">MAIL_FROM_NAME</span><span class="token operator">=</span>孙美丽<span class="token shell-comment comment"># qzjkngzxjmrneacc  qq邮箱授权码</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol></li><li><p>MustVerifyEmailTrait（无强制认证，需要写中间件逻辑）</p><ol><li><p>修改<code>User</code>模型，将 Laravel 自带的邮箱认证功能集成到我们的程序中</p><p><em>app/Models/User.php</em></p><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Auth<span class="token punctuation">\</span>MustVerifyEmail</span> <span class="token keyword">as</span> MustVerifyEmailTrait<span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Authenticatable</span> <span class="token keyword">implements</span> <span class="token class-name">MustVerifyEmail</span><span class="token punctuation">{</span>    <span class="token keyword">use</span> <span class="token package">HasApiTokens</span><span class="token punctuation">,</span> HasFactory<span class="token punctuation">,</span> Notifiable<span class="token punctuation">,</span> MustVerifyEmailTrait<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>配置env（同上）</p></li><li><p>强制认证，中间件逻辑</p><p>创建中间件</p><pre class="line-numbers language-php"><code class="language-php">php artisan make<span class="token punctuation">:</span>middleware EnsureEmailIsVerified<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>写入一下内容</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Middleware</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Closure</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Request</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">EnsureEmailIsVerified</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">handle</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">,</span> Closure <span class="token variable">$next</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 三个判断：</span>        <span class="token comment" spellcheck="true">// 1. 如果用户已经登录</span>        <span class="token comment" spellcheck="true">// 2. 并且还未认证 Email</span>        <span class="token comment" spellcheck="true">// 3. 并且访问的不是 email 验证相关 URL 或者退出的 URL。</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>            <span class="token operator">!</span> <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">hasVerifiedEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>            <span class="token operator">!</span> <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">is</span><span class="token punctuation">(</span><span class="token string">'email/*'</span><span class="token punctuation">,</span> <span class="token string">'logout'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// 根据客户端返回对应的内容</span>            <span class="token keyword">return</span> <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">expectsJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                        <span class="token operator">?</span> <span class="token function">abort</span><span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">,</span> <span class="token string">'Your email address is not verified.'</span><span class="token punctuation">)</span>                        <span class="token punctuation">:</span> <span class="token function">redirect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">'verification.notice'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token variable">$next</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>注册中间件<em>app/Http/Kernel.php</em>注册的时机确保在 <code>StartSession</code> 后面即可</p><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">protected</span> <span class="token variable">$middlewareGroups</span> <span class="token operator">=</span> <span class="token punctuation">[</span>        <span class="token string">'web'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span>            \<span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Middleware<span class="token punctuation">\</span>EncryptCookies</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span>            \<span class="token package">Illuminate<span class="token punctuation">\</span>Cookie<span class="token punctuation">\</span>Middleware<span class="token punctuation">\</span>AddQueuedCookiesToResponse</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span>            \<span class="token package">Illuminate<span class="token punctuation">\</span>Session<span class="token punctuation">\</span>Middleware<span class="token punctuation">\</span>StartSession</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span>            <span class="token comment" spellcheck="true">// \Illuminate\Session\Middleware\AuthenticateSession::class,</span>            \<span class="token package">Illuminate<span class="token punctuation">\</span>View<span class="token punctuation">\</span>Middleware<span class="token punctuation">\</span>ShareErrorsFromSession</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span>            \<span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Middleware<span class="token punctuation">\</span>VerifyCsrfToken</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span>            \<span class="token package">Illuminate<span class="token punctuation">\</span>Routing<span class="token punctuation">\</span>Middleware<span class="token punctuation">\</span>SubstituteBindings</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span>            \<span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Middleware<span class="token punctuation">\</span>EnsureEmailIsVerified</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span>      <span class="token comment" spellcheck="true">// &lt;&lt;--- 只需添加这一行</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>限额次数可在 app/Http/Controllers/Auth/VerificationController.php 文件中的这一行配置：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">middleware</span><span class="token punctuation">(</span><span class="token string">'throttle:6,1'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">only</span><span class="token punctuation">(</span><span class="token string">'verify'</span><span class="token punctuation">,</span> <span class="token string">'resend'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ol></li></ul><h2 id="上传图片（限制分辨率，裁剪头像）"><a href="#上传图片（限制分辨率，裁剪头像）" class="headerlink" title="上传图片（限制分辨率，裁剪头像）"></a>上传图片（限制分辨率，裁剪头像）</h2><h3 id="未完继续更新"><a href="#未完继续更新" class="headerlink" title="未完继续更新"></a>未完继续更新</h3><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> Laravel </category>
          
      </categories>
      
      
        <tags>
            
            <tag> laravel </tag>
            
            <tag> 代码块 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Laravel常用扩展</title>
      <link href="/2022/10/10/laravel-chang-yong-kuo-zhan/"/>
      <url>/2022/10/10/laravel-chang-yong-kuo-zhan/</url>
      
        <content type="html"><![CDATA[<h2 id="安装laravel指定版本"><a href="#安装laravel指定版本" class="headerlink" title="安装laravel指定版本"></a>安装laravel指定版本</h2><pre class="line-numbers language-php"><code class="language-php">composer create<span class="token operator">-</span>project laravel<span class="token operator">/</span>laravel laravel<span class="token operator">-</span>shop <span class="token operator">--</span>prefer<span class="token operator">-</span>dist <span class="token string">"8.*"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="中文语言包"><a href="#中文语言包" class="headerlink" title="中文语言包"></a>中文语言包</h2><h2 id="验证码"><a href="#验证码" class="headerlink" title="验证码"></a>验证码</h2><h3 id="未完继续更新"><a href="#未完继续更新" class="headerlink" title="未完继续更新"></a>未完继续更新</h3><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> Laravel </category>
          
      </categories>
      
      
        <tags>
            
            <tag> laravel </tag>
            
            <tag> 插件 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
